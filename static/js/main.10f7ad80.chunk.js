(this["webpackJsonpmy-app"]=this["webpackJsonpmy-app"]||[]).push([[0],{103:function(e,t,a){},104:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),s=a(17),o=a.n(s),c=a(53),i=a(15),l=a(14),u=a(3),m=a(4),p=a(6),d=a(5),b=[{label:"\u041f\u043e\u043f\u043e\u043b\u044f\u0440\u043d\u044b\u0435 \u043f\u043e \u0443\u0431\u044b\u0432\u0430\u043d\u0438\u044e",value:"popularity.asc"},{label:"\u041f\u043e\u043f\u043e\u043b\u044f\u0440\u043d\u044b\u0435 \u043f\u043e \u0432\u043e\u0437\u0440\u043e\u0441\u0442\u0430\u043d\u0438\u044e",value:"popularity.desc"},{label:"\u0420\u0435\u0439\u0442\u0438\u043d\u0433 \u043f\u043e \u0443\u0431\u044b\u0432\u0430\u043d\u0438\u044e",value:"vote_average.asc"},{label:"\u0420\u0435\u0439\u0442\u0438\u043d\u0433 \u043f\u043e \u0432\u043e\u0437\u0440\u043e\u0441\u0442\u0430\u043d\u0438\u044e",value:"vote_average.desc"}],h=function(e){Object(p.a)(a,e);var t=Object(d.a)(a);function a(){return Object(u.a)(this,a),t.apply(this,arguments)}return Object(m.a)(a,[{key:"render",value:function(){var e=this.props,t=e.sort_by,a=e.onChangeFilters;return r.a.createElement("div",null,r.a.createElement("div",{className:"form-group"},r.a.createElement("label",{htmlFor:"sort_by"},"\u0421\u043e\u0440\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u043f\u043e:"),r.a.createElement("select",{className:"form-control",id:"sort_by",name:"sort_by",value:t,onChange:a},b.map((function(e){return r.a.createElement("option",{key:e.value,value:e.value},e.label)})))))}}]),a}(r.a.PureComponent),g=function(e){Object(p.a)(a,e);var t=Object(d.a)(a);function a(){return Object(u.a)(this,a),t.apply(this,arguments)}return Object(m.a)(a,[{key:"render",value:function(){var e=this.props,t=e.page,a=e.onChangePagination,n=e.total_pages;return r.a.createElement("div",{className:"btn-group"},r.a.createElement("button",{type:"button",className:"btn btn-secondary m-2",disabled:1===t,onClick:function(){a(t-1)}},"\u041d\u0430\u0437\u0430\u0434"),r.a.createElement("label",null,t," \u0438\u0437 ",n),r.a.createElement("button",{type:"button",className:"btn btn-secondary m-2",disabled:t===n,onClick:function(){a(t+1)}},"\u0412\u043f\u0435\u0440\u0435\u0434"))}}]),a}(r.a.Component),v=[{label:"2020",value:"2020"},{label:"2019",value:"2019"},{label:"2018",value:"2018"},{label:"2017",value:"2017"},{label:"2016",value:"2016"}],f=function(e){Object(p.a)(a,e);var t=Object(d.a)(a);function a(){return Object(u.a)(this,a),t.apply(this,arguments)}return Object(m.a)(a,[{key:"render",value:function(){var e=this.props,t=e.primary_release_year,a=e.onChangeFilters;return r.a.createElement("div",{className:"form-group"},r.a.createElement("label",null,"\u041f\u043e \u0434\u0430\u0442\u0435 \u0432\u044b\u043f\u0443\u0441\u043a\u0430:"),r.a.createElement("select",{name:"primary_release_year",className:"form-control",value:t,onChange:a},v.map((function(e){return r.a.createElement("option",{key:e.value,value:e.value},e.label)}))))}}]),a}(r.a.PureComponent),y=[{id:28,name:"\u0431\u043e\u0435\u0432\u0438\u043a"},{id:12,name:"\u043f\u0440\u0438\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u044f"},{id:16,name:"\u043c\u0443\u043b\u044c\u0442\u0444\u0438\u043b\u044c\u043c"},{id:35,name:"\u043a\u043e\u043c\u0435\u0434\u0438\u044f"},{id:80,name:"\u043a\u0440\u0438\u043c\u0438\u043d\u0430\u043b"},{id:99,name:"\u0434\u043e\u043a\u0443\u043c\u0435\u043d\u0442\u0430\u043b\u044c\u043d\u044b\u0439"},{id:18,name:"\u0434\u0440\u0430\u043c\u0430"},{id:10751,name:"\u0441\u0435\u043c\u0435\u0439\u043d\u044b\u0439"},{id:14,name:"\u0444\u044d\u043d\u0442\u0435\u0437\u0438"},{id:36,name:"\u0438\u0441\u0442\u043e\u0440\u0438\u044f"},{id:27,name:"\u0443\u0436\u0430\u0441\u044b"},{id:10402,name:"\u043c\u0443\u0437\u044b\u043a\u0430"},{id:9648,name:"\u0434\u0435\u0442\u0435\u043a\u0442\u0438\u0432"},{id:10749,name:"\u043c\u0435\u043b\u043e\u0434\u0440\u0430\u043c\u0430"},{id:878,name:"\u0444\u0430\u043d\u0442\u0430\u0441\u0442\u0438\u043a\u0430"},{id:10770,name:"\u0442\u0435\u043b\u0435\u0432\u0438\u0437\u0438\u043e\u043d\u043d\u044b\u0439 \u0444\u0438\u043b\u044c\u043c"},{id:53,name:"\u0442\u0440\u0438\u043b\u043b\u0435\u0440"},{id:10752,name:"\u0432\u043e\u0435\u043d\u043d\u044b\u0439"},{id:37,name:"\u0432\u0435\u0441\u0442\u0435\u0440\u043d"}],E=function(e){Object(p.a)(a,e);var t=Object(d.a)(a);function a(){return Object(u.a)(this,a),t.apply(this,arguments)}return Object(m.a)(a,[{key:"render",value:function(){var e=this;return r.a.createElement("div",null,y.map((function(t){return r.a.createElement("div",{key:t.id},r.a.createElement("input",{type:"checkbox",className:"m-2",name:"with_genres",value:t.id,onChange:e.props.onChangeGenre}),r.a.createElement("label",null,t.name))})))}}]),a}(r.a.PureComponent),O=function(e){Object(p.a)(a,e);var t=Object(d.a)(a);function a(){return Object(u.a)(this,a),t.apply(this,arguments)}return Object(m.a)(a,[{key:"render",value:function(){var e=this.props,t=e.filters,a=t.sort_by,n=t.primary_release_year,s=t.with_genres,o=e.onChangeFilters,c=e.onChangePagination,i=e.page,l=e.total_pages,u=e.onChangeGenre;return r.a.createElement("form",{className:"mb-3"},r.a.createElement(h,{sort_by:a,onChangeFilters:o}),r.a.createElement(f,{primary_release_year:n,onChangeFilters:o}),r.a.createElement(E,{with_genres:s,onChangeFilters:o,onChangeGenre:u}),r.a.createElement(g,{page:i,total_pages:l,onChangePagination:c}))}}]),a}(r.a.Component),j=a(107),_=a(105),k=a(33),C=a.n(k),N=a(49),w=(a(63),"https://api.themoviedb.org/3"),S="5a3283303e8b71660db01b96fb67c038",P=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new Promise((function(a,n){fetch(e,t).then((function(e){if(e.status<400)return e.json();throw e})).then((function(e){return a(e)})).catch((function(e){return e.json().then((function(e){return n(e)}))}))}))},F=a(10),x=a.n(F),M=function(e){return function(t){Object(p.a)(n,t);var a=Object(d.a)(n);function n(){return Object(u.a)(this,n),a.apply(this,arguments)}return Object(m.a)(n,[{key:"render",value:function(){var t=this;return r.a.createElement(V.Consumer,null,(function(a){return r.a.createElement(e,Object.assign({},a,t.props))}))}}]),n}(r.a.Component)},I=M(function(e){Object(p.a)(a,e);var t=Object(d.a)(a);function a(){var e;Object(u.a)(this,a);for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(e=t.call.apply(t,[this].concat(r))).state={username:"",password:"",errors:{},submitting:!1},e.onChange=function(t){var a=t.target.name,n=t.target.value;e.setState((function(e){var t,r;return r={},Object(i.a)(r,a,n),Object(i.a)(r,"errors",Object(l.a)(Object(l.a)({},e.errors),{},(t={},Object(i.a)(t,a,null),Object(i.a)(t,"base",null),t))),r}))},e.handleBlur=function(t){var a=t.target.name,n=e.validFields(),r=n[a];Object.keys(n).length>0&&e.setState((function(e){return{errors:Object(l.a)(Object(l.a)({},e.errors),{},Object(i.a)({},a,r))}}))},e.validFields=function(){var t={};return""===e.state.username&&(t.username="Required"),e.state.password.length<5&&(t.password="Required. Must be 5 characters or more"),t},e.onSubmit=Object(N.a)(C.a.mark((function t(){var a,n,r,s;return C.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,e.setState({submitting:!0}),t.next=4,P("".concat(w,"/authentication/token/new?api_key=").concat(S));case 4:return a=t.sent,t.next=7,P("".concat(w,"/authentication/token/validate_with_login?api_key=").concat(S),{method:"POST",mode:"cors",headers:{"content-type":"application/json"},body:JSON.stringify({username:e.state.username,password:e.state.password,request_token:a.request_token})});case 7:return n=t.sent,t.next=10,P("".concat(w,"/authentication/session/new?api_key=").concat(S),{method:"POST",mode:"cors",headers:{"content-type":"application/json"},body:JSON.stringify({request_token:n.request_token})});case 10:return r=t.sent,e.props.getSessionId(r.session_id),t.next=14,P("".concat(w,"/account?api_key=").concat(S,"&session_id=").concat(r.session_id));case 14:s=t.sent,e.setState({submitting:!1},(function(){e.props.getUser(s)})),t.next=21;break;case 18:t.prev=18,t.t0=t.catch(0),e.setState({submitting:!1,errors:{base:t.t0.status_message}});case 21:case"end":return t.stop()}}),t,null,[[0,18]])}))),e.onLogin=function(t){t.preventDefault();var a=e.validFields();Object.keys(a).length>0?e.setState((function(e){return{errors:Object(l.a)(Object(l.a)({},e.errors),a)}})):e.onSubmit()},e.getClassForInput=function(t){return x()("form-control",{invalid:e.state.errors[t]})},e}return Object(m.a)(a,[{key:"render",value:function(){var e=this.state,t=e.errors,a=e.username,n=e.password,s=e.submitting;return r.a.createElement("div",{className:"container"},r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col-12"},r.a.createElement("div",{className:"card my-5"},r.a.createElement("div",{className:"card-body"},r.a.createElement("h4",{className:"card-title text-center"},"Sign In"),r.a.createElement("form",{className:"form-signin"},r.a.createElement("div",{className:"form-label-group"},r.a.createElement("label",{htmlFor:"inputName"},"Login"),r.a.createElement("input",{name:"username",value:a,type:"text",id:"inputName",className:this.getClassForInput("username"),placeholder:"shkaf4uk",required:!0,onChange:this.onChange,onBlur:this.handleBlur})),t.username&&r.a.createElement("div",{className:"invalid-feedback"},t.username),r.a.createElement("div",{className:"form-label-group"},r.a.createElement("label",{htmlFor:"inputPassword"},"Password"),r.a.createElement("input",{name:"password",value:n,type:"password",id:"inputPassword",className:this.getClassForInput("password"),placeholder:"1q2w3e",required:!0,onChange:this.onChange})),t.password&&r.a.createElement("div",{className:"invalid-feedback"},t.password),r.a.createElement("div",{className:"custom-control custom-checkbox mb-3"},r.a.createElement("input",{type:"checkbox",className:"custom-control-input",id:"customCheck1"}),r.a.createElement("label",{className:"custom-control-label",htmlFor:"customCheck1"},"Remember me")),r.a.createElement("button",{className:"btn btn-lg btn-primary btn-block text-uppercase",type:"submit",onClick:this.onLogin,disabled:s},"Sign In"),t.base&&r.a.createElement("div",{className:"invalid-feedback text-center"},t.base)))))))}}]),a}(r.a.PureComponent)),L=function(e){Object(p.a)(a,e);var t=Object(d.a)(a);function a(){var e;return Object(u.a)(this,a),(e=t.call(this)).toggleModal=function(){e.setState((function(e){return{showModal:!e.showModal}}))},e.state={showModal:!1},e}return Object(m.a)(a,[{key:"render",value:function(){return r.a.createElement("div",null,r.a.createElement("button",{className:"btn btn-success",type:"button",onClick:this.toggleModal},"Login"),r.a.createElement(j.a,{isOpen:this.state.showModal,toggle:this.toggleModal},r.a.createElement(_.a,null,r.a.createElement(I,null))))}}]),a}(r.a.PureComponent),q=a(54),U=a(106),G=a(108),D=a(109),J=M((function(e){var t=Object(n.useState)(!1),a=Object(q.a)(t,2),s=a[0],o=a[1],c=function(){return o((function(e){return!e}))};return r.a.createElement(U.a,{isOpen:s,toggle:c},r.a.createElement(G.a,{tag:"span","data-toggle":"dropdown","aria-expanded":s},r.a.createElement("img",{className:"rounded-circle",src:"https://www.gravatar.com/avatar/".concat(e.user.avatar.gravatar.hash,"?s=40"),alt:""})),r.a.createElement(D.a,{right:!0},r.a.createElement("div",{onClick:function(){P("".concat(w,"/authentication/session?api_key=").concat(S),{method:"DELETE",mode:"cors",headers:{"content-type":"application/json"},body:JSON.stringify({session_id:e.session_id})}).then((function(){e.onLogOut(),c()}))}},"Log out")))})),B=function(e){Object(p.a)(a,e);var t=Object(d.a)(a);function a(){return Object(u.a)(this,a),t.apply(this,arguments)}return Object(m.a)(a,[{key:"render",value:function(){var e=this.props.user;return r.a.createElement("nav",{className:"navbar navbar-dark bg-primary"},r.a.createElement("div",{className:"container"},r.a.createElement("ul",{className:"navbar-nav mr-auto"},r.a.createElement("li",{className:"nav-item active"},r.a.createElement("a",{className:"nav-link"},"Home"))),e?r.a.createElement(J,null):r.a.createElement(L,null)))}}]),a}(r.a.Component),R=a(55),T=function(e){Object(p.a)(a,e);var t=Object(d.a)(a);function a(){return Object(u.a)(this,a),t.apply(this,arguments)}return Object(m.a)(a,[{key:"render",value:function(){var e=this.props.movie,t=e.backdrop_path||e.poster_path;return r.a.createElement("div",{className:"card"},r.a.createElement("img",{className:"card-img-top card-img-height",src:t?"https://image.tmdb.org/t/p/w500".concat(t):"https://d1csarkz8obe9u.cloudfront.net/posterpreviews/movie-poster-template-for-free-design-a28c2f452f5c988ef92d66875b784209_screen.jpg?ts=1561393990",alt:""}),r.a.createElement("div",{className:"card-body"},r.a.createElement("h6",{className:"card-title"},e.title),r.a.createElement("div",{className:"d-flex justify-content-between align-items-center"},r.a.createElement("p",{className:"mb-0"},"\u0420\u0435\u0439\u0442\u0438\u043d\u0433: ",e.vote_average),r.a.createElement("button",{type:"button",className:"btn btn-success"},"Will Watch")),r.a.createElement("button",{type:"button"},"Watched")))}}]),a}(r.a.Component),W=a(52),A=a.n(W),z=function(e){var t=e.movies;return r.a.createElement("div",{className:"row"},t.map((function(e){return r.a.createElement("div",{className:"col-6 p-4",key:e.id},r.a.createElement("div",{className:"row"},r.a.createElement(T,{movie:e})))})))};z.defaultProps={movies:[]};var H,K=(H=z,function(e){Object(p.a)(a,e);var t=Object(d.a)(a);function a(){var e;return Object(u.a)(this,a),(e=t.call(this)).getMovies=function(t,a){var n=e.props.filters,r=n.sort_by,s=n.primary_release_year,o=n.with_genres,c={api_key:S,language:"ru-RU",sort_by:r,page:a,primary_release_year:s};o.length>0&&(c.with_genres=o);var i="".concat(w,"/discover/movie?").concat(A.a.stringify(c));fetch(i).then((function(e){return e.json()})).then((function(t){e.setState({movies:t.results,total_pages:t.total_pages}),e.props.onChangePagination(a,e.state.total_pages)}))},e.state={movies:[]},e}return Object(m.a)(a,[{key:"componentDidMount",value:function(){this.getMovies(this.props.filters.sort_by,this.props.page)}},{key:"componentDidUpdate",value:function(e,t){e.filters!==this.props.filters&&(this.getMovies(this.props.filters.sort_by,1),this.props.onChangePagination(1)),e.page!==this.props.page&&this.getMovies(this.props.filters.sort_by,this.props.page)}},{key:"render",value:function(){var e=this.state.movies;return r.a.createElement(H,{movies:e})}}]),a}(r.a.Component)),Q=new R.a,V=r.a.createContext(),X=function(e){Object(p.a)(a,e);var t=Object(d.a)(a);function a(){var e;return Object(u.a)(this,a),(e=t.call(this)).getUser=function(t){e.setState({user:t})},e.getSessionId=function(t){Q.set("session_id",t,{path:"/",maxAge:3600}),e.setState({session_id:t})},e.onLogOut=function(){Q.remove("session_id",{path:"/"}),e.setState({session_id:null,user:null})},e.onChangeFilters=function(t){var a=Object(l.a)(Object(l.a)({},e.state.filters),{},Object(i.a)({},t.target.name,[t.target.value]));e.setState({filters:a})},e.onChangePagination=function(t){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.state.total_pages;e.setState({page:t,total_pages:a})},e.onChangeGenre=function(t){var a=t.target.value,n=e.state.filters.with_genres,r=[];r=n.includes(a)?n.filter((function(e){return e!==a})):[].concat(Object(c.a)(n),[a]),e.setState((function(e){return{filters:Object(l.a)(Object(l.a)({},e.filters),{},{with_genres:r})}}))},e.state={user:null,session_id:null,filters:{sort_by:"popularity.desc",primary_release_year:"2020",with_genres:[]},page:1,total_pages:0},e}return Object(m.a)(a,[{key:"componentDidMount",value:function(){var e=this,t=Q.get("session_id",{});t&&P("".concat(w,"/account?api_key=").concat(S,"&session_id=").concat(t)).then((function(a){e.getUser(a),e.getSessionId(t)}))}},{key:"render",value:function(){var e=this.state,t=e.filters,a=e.page,n=e.total_pages,s=e.user,o=e.session_id;return r.a.createElement(V.Provider,{value:{user:s,session_id:o,getUser:this.getUser,getSessionId:this.getSessionId,onLogOut:this.onLogOut}},r.a.createElement("div",null,r.a.createElement(B,{user:s}),r.a.createElement("div",{className:"container"},r.a.createElement("div",{className:"row mt-4"},r.a.createElement("div",{className:"col-9"},r.a.createElement(K,{filters:t,page:a,onChangePagination:this.onChangePagination})),r.a.createElement("div",{className:"col-3"},r.a.createElement("h4",null,"\u0424\u0438\u043b\u044c\u0442\u0440\u044b"),r.a.createElement(O,{filters:t,onChangeFilters:this.onChangeFilters,page:a,total_pages:n,onChangePagination:this.onChangePagination,onChangeGenre:this.onChangeGenre}))))))}}]),a}(r.a.Component);a(102),a(103);o.a.render(r.a.createElement(X,null),document.getElementById("root"))},57:function(e,t,a){e.exports=a(104)},63:function(e,t,a){}},[[57,1,2]]]);
//# sourceMappingURL=main.10f7ad80.chunk.js.map